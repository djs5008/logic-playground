!function(t){var e={};function o(n){if(e[n])return e[n].exports;var s=e[n]={i:n,l:!1,exports:{}};return t[n].call(s.exports,s,s.exports,o),s.l=!0,s.exports}o.m=t,o.c=e,o.d=function(t,e,n){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},o.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)o.d(n,s,function(e){return t[e]}.bind(null,s));return n},o.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="",o(o.s=0)}([function(t,e,o){"use strict";o.r(e);class n{constructor(t){this.context=t}handleMouseMove(){}handleMouseDragLeft(){}handleMouseDragRight(){}handleLeftClickDown(){}handleRightClickDown(){}handleLeftClickUp(){}handleRightClickUp(){}handleDoubleClick(){}}const s={EMPTY:"EMPTY",PANNING:"PANNING",DRAGGING:"DRAGGING",HOVER_COMPONENT:"HOVER_COMPONENT",HOVER_CONNECTOR:"HOVER_CONNECTOR",SELECTING:"SELECTING",CONNECTING:"CONNECTING"};class i extends n{constructor(t){super(t)}handleMouseMove(){let t=this.context.getHoveredConnector(),e=this.context.getHoveredComponent();null!==t?this.context.setActiveState(s.HOVER_CONNECTOR,t):null!==e&&this.context.setActiveState(s.HOVER_COMPONENT,e)}handleLeftClickDown(){this.context.selectionRect=new createjs.Rectangle(this.context.clickPos.x,this.context.clickPos.y,0,0),this.context.setActiveState(s.SELECTING)}handleRightClickDown(){this.context.setActiveState(s.PANNING)}}class r extends n{constructor(t,e){super(t),this.hoveredConn=e,this.hoveredSSD=null}handleMouseMove(){let t=this.context.getHoveredConnector();if(null!==t){if(t!==this.hoveredConn)return void this.changeState(s.HOVER_CONNECTOR,t);let e=this.context.moduleController.activeModule.getComponent(t);null!==e&&"SEVEN-SEG-DISP"===e.type&&(e.setHoveredConnector(t),this.hoveredSSD=e)}else this.changeState(s.EMPTY)}handleMouseDragLeft(){this.changeState(s.CONNECTING,this.hoveredConn)}handleMouseDragRight(){this.changeState(s.PANNING)}handleLeftClickUp(){this.changeState(s.CONNECTING,this.hoveredConn)}handleRightClickUp(){this.context.moduleController.breakConnections(this.hoveredConn)}changeState(t,e){null!==this.hoveredSSD&&(this.hoveredSSD.setHoveredConnector(null),this.hoveredSSD=null),this.context.setActiveState(t,e)}}class l extends n{constructor(t,e){super(t),this.hoveredComp=e}handleMouseMove(){let t=this.context.getHoveredComponent();null===t?this.context.setActiveState(s.EMPTY):t!=this.hoveredComp&&this.context.setActiveState(s.HOVER_COMPONENT,t)}handleMouseDragLeft(){}handleMouseDragRight(){this.context.setActiveState(s.PANNING)}handleLeftClickDown(){this.context.selectedComponents.includes(this.hoveredComp)||(this.context.selectedComponents=[this.hoveredComp]),this.context.setActiveState(s.DRAGGING)}handleRightClickDown(){this.hoveredComp.rightClickDownEvent()}handleLeftClickUp(){}handleRightClickUp(){this.hoveredComp.rightClickUpEvent()}handleDoubleClick(){if(1===this.context.selectedComponents.length){let t=this.context.selectedComponents[0];"MODULE"===t.type&&(this.context.moduleController.activeModules.push(this.context.moduleController.activeModule),this.context.moduleController.setActiveModule(t),this.context.clearSelection(),$("#module-back-button").css("visibility","visible"),$("#module-nathis.context").val(this.context.moduleController.activeModule.label))}}}class c extends n{constructor(t){super(t)}handleMouseDragRight(t){let e=this.context.moduleController.activeModule.startPos,o=this.context.mousePos.x-this.context.clickPos.x,n=this.context.mousePos.y-this.context.clickPos.y;e.x+=o,e.y+=n,this.context.selectionRect.x+=o,this.context.selectionRect.y+=n,this.context.clickPos=new createjs.Point(t.stageX,t.stageY)}handleRightClickUp(){this.unpan()}handleLeftClickUp(){this.unpan()}unpan(){var t=this.context.getHoveredComponent(),e=this.context.getHoveredConnector();null!==t?this.context.setActiveState(s.HOVER_COMPONENT,t):null!==e?this.context.setActiveState(s.HOVER_CONNECTOR,e):this.context.setActiveState("EMPTY")}}class a extends n{constructor(t){super(t)}handleMouseDragLeft(){let t=this.context.mousePos,e=this.context.clickPos;this.context.selectedComponents=this.context.getSelectedComponents(),this.context.selectionRect=new createjs.Rectangle(t.x>e.x?e.x:t.x,t.y>e.y?e.y:t.y,t.x>e.x?t.x-e.x:e.x-t.x,t.y>e.y?t.y-e.y:e.y-t.y)}handleLeftClickUp(){this.context.getSelectedComponents().length>0?this.context.wrapSelection():this.context.clearSelection(),this.context.getSelectedComponents().length>1&&this.context.toggleComponentSettings(!1);var t=this.context.getHoveredComponent(),e=this.context.getHoveredConnector();null!==t?this.context.setActiveState(s.HOVER_COMPONENT,t):null!==e?this.context.setActiveState(s.HOVER_CONNECTOR,e):this.context.setActiveState(s.EMPTY)}handleDoubleClick(){this.context.setActiveState(s.PANNING)}}class h extends n{constructor(t){super(t)}handleMouseDragLeft(t){let e=this.context.mousePos.x-this.context.clickPos.x,o=this.context.mousePos.y-this.context.clickPos.y;this.context.selectedComponents.forEach(t=>t.move(e,o)),this.context.selectionRect.x+=e,this.context.selectionRect.y+=o,this.context.clickPos=new createjs.Point(t.stageX,t.stageY)}handleLeftClickUp(){1===this.context.selectedComponents.length&&this.context.showComponentSelection();var t=this.context.getHoveredComponent(),e=this.context.getHoveredConnector();null!==t?this.context.setActiveState(s.HOVER_COMPONENT,t):null!==e?this.context.setActiveState(s.HOVER_CONNECTOR,e):this.context.setActiveState(s.EMPTY)}}class d extends n{constructor(t,e){super(t),this.selectedConn=e,this.context.selectedConnector=e,this.hoveredConn=null,this.hoveredSSD=null}handleMouseMove(){if(this.hoveredConn=this.context.getHoveredConnector(),null!==this.hoveredConn){let t=this.context.moduleController.activeModule.getComponent(this.hoveredConn);null!==t&&"SEVEN-SEG-DISP"===t.type&&(t.setHoveredConnector(this.hoveredConn),this.hoveredSSD=t)}else null!==this.hoveredSSD&&(this.hoveredSSD.setHoveredConnector(null),this.hoveredSSD=null)}handleLeftClickUp(){let t=this.hoveredConn;if(null!==t){if(null!==this.selectedConn&&this.selectedConn!==t&&this.selectedConn.isOutput()!==t.isOutput()&&!this.selectedConn.getConnections().includes(t.getID())&&!t.getConnections().includes(this.selectedConn.getID())){let e=this.selectedConn.isOutput()?this.selectedConn:t;return(e===this.selectedConn?t:this.selectedConn).addConnection(e),this.context.moduleController.activeModule.updateConnectorMap(),this.context.selectedConnector=null,void this.context.setActiveState(s.HOVER_CONNECTOR,t)}if(this.selectedConn===t)return}this.context.selectedConnector=null,this.context.setActiveState(s.EMPTY)}}const u=0,g=2;class p{constructor(t,e,o){this.label="",this.type=t,this.superType=e,this.bounds=o,this.connectors=[],this.id=this.id?this.id:uuid()}paint(){}loadSettings(t){t.html("")}moveTo(t,e){const o=this.bounds.x,n=this.bounds.y;this.bounds.x=t,this.bounds.y=e;var s=this.bounds.x-o,i=this.bounds.y-n;this.connectors.forEach(t=>{t.moveTo(t.bounds.x+s,t.bounds.y+i)})}move(t,e){this.moveTo(this.bounds.x+t,this.bounds.y+e)}getConnectors(){return this.connectors}getOutputConnectors(){var t=[];return this.connectors.forEach(e=>{e.isOutput()&&t.push(e)}),t}getInputConnectors(){var t=[];return this.connectors.forEach(e=>{e.isInput()&&t.push(e)}),t}isGate(){return"GATE"===this.superType}isOutputComp(){return"OUTPUT"===this.superType}isInputComp(){return"INPUT"===this.superType}rightClickDownEvent(){}leftClickDownEvent(){}rightClickUpEvent(){}leftClickUpEvent(){}doubleClickEvent(){}exportImage(){var t=new createjs.Shape,e=t.graphics;return this.paint(e,{x:5,y:5}),t.cache(0,0,this.bounds.width+10,this.bounds.height+10),t.bitmapCache.getCacheDataURL()}}const b=5;class C extends p{constructor(t,e){super("CONNECTOR","MISC",t),this.bounds.width=b,this.bounds.height=b,this.state=!1,this.type=e,this.connections=[]}getRealBounds(){return new createjs.Rectangle(this.bounds.x-b,this.bounds.y-b,2*b,2*b)}getState(){return this.state}updateState(t){this.state=t}isInput(){return"INPUT"===this.type}isOutput(){return"OUTPUT"===this.type}getID(){return this.id}addConnection(t){this.connections.push(t.getID())}removeConnection(t){this.connections=this.connections.filter(e=>e!==t.getID())}getConnections(){return this.connections}paint(t,e){var o=this.getState()?"rgb(0,200,0)":"rgb(200,0,0)";t.beginFill(o).drawCircle(e.x,e.y,this.bounds.width).endFill()}}class v extends p{constructor(t,e,o){super(t,e,o)}propagate(){}}const S="unnamed",m=40,x=20;class y extends v{constructor(t){super("MODULE","MODULE",t),this.label=S,this.components=[],this.startPos={x:0,y:0},this.connectorMap={},this.updateBounds(),this.updateConnectorMap(),this.propagate()}propagate(t){let e=this;this.components.forEach(o=>{o.getInputConnectors().forEach(o=>{!function(o){let n=!1;if(o.getConnections().forEach(t=>{n||e.getOutputConnectorFromID(t).getState()&&(n=!0)}),o.getState()!==n){o.updateState(n);let s=e.getComponent(o);s.isGate()?s.propagate():"MODULE"===s.type?(s.getInputComponent(o).setState(o.getState()),t||e.propagate(!1)):s.isOutputComp()&&(e.getOutputConnector(s).updateState(s.getState()),s.stateChangedEvent())}}(o)})}),this.components.forEach(t=>{"MODULE"===t.type&&t.propagate(!1)})}updateConnectorMap(){var t=this;this.connectorMap={},this.components.forEach(e=>{e.getInputConnectors().forEach(e=>{var o=e.getID();t.connectorMap[o]=[],e.getConnections().forEach(e=>{var n=t.getConnector(e);null!==n&&t.connectorMap[o].push(n)})})})}getConnectorMap(){return this.connectorMap}addComponent(t){return this.components.push(t),t.isInputComp()?this.connectors.push(new C({x:this.bounds.x,y:this.bounds.y},"INPUT")):t.isOutputComp()&&this.connectors.push(new C({x:this.bounds.x,y:this.bounds.y},"OUTPUT")),this.updateBounds(),t}removeComponent(t){let e=null;t.isInputComp()?e=this.getInputConnector(t):t.isOutputComp()&&(e=this.getOutputConnector(t)),this.components=this.components.filter(e=>e!==t),this.connectors=this.connectors.filter(t=>t!==e),this.components.forEach(e=>{e.getConnectors().forEach(e=>{t.getConnectors().forEach(t=>{e.removeConnection(t)})})}),this.updateBounds()}getInputComponents(){let t=[];return this.components.forEach(e=>{e.isInputComp()&&t.push(e)}),t}getOutputComponents(){let t=[];return this.components.forEach(e=>{e.isOutputComp()&&t.push(e)}),t}getInputComponent(t){let e=this.getInputConnectors().indexOf(t);return this.getInputComponents()[e]}getOutputComponent(t){let e=this.getOutputConnectors().indexOf(t);return this.getOutputComponents()[e]}getInputConnector(t){if(t.isInputComp()){let e=this.getInputComponents().indexOf(t);return this.getInputConnectors()[e]}return null}getOutputConnector(t){if(t.isOutputComp()){let e=this.getOutputComponents().indexOf(t);return this.getOutputConnectors()[e]}return null}getConnector(t){let e=null;return this.components.forEach(o=>{null===e&&o.getConnectors().forEach(o=>{o.getID()!==t||(e=o)})}),e}getOutputConnectorFromID(t){let e=null;return this.components.forEach(o=>{null===e&&o.getOutputConnectors().forEach(o=>{o.getID()!==t||(e=o)})}),e}getInputConnectorFromID(t){let e=null;return this.components.forEach(o=>{null===e&&o.getInputConnectors().forEach(o=>{o.getID()!==t||(e=o)})}),e}getComponent(t){let e=null;return this.components.forEach(o=>{if(null!==e)return!1;o.getConnectors().forEach(n=>{if(t.getID()===n.getID())return e=o,!1})}),e}updateBounds(){let t=this.getInputConnectors().length<this.getOutputConnectors().length?this.getOutputConnectors().length:this.getInputConnectors().length;this.bounds=new createjs.Rectangle(this.bounds.x,this.bounds.y,m,x*(t+1));let e=this;this.getInputConnectors().forEach(t=>{let o=e.bounds.height/(e.getInputConnectors().length+1),n=e.getInputConnectors().indexOf(t);t.bounds.x=e.bounds.x-10,t.bounds.y=e.bounds.y+o*(n+1)}),this.getOutputConnectors().forEach(t=>{let o=e.bounds.height/(e.getOutputConnectors().length+1),n=e.getOutputConnectors().indexOf(t);t.bounds.x=e.bounds.x+e.bounds.width+10,t.bounds.y=e.bounds.y+o*(n+1)})}paint(t,e){let o=this;t.beginFill("rgba(0,0,0,0.8)").beginStroke("rgb(0,0,0)").setStrokeStyle(2).drawRect(e.x,e.y,this.bounds.width,this.bounds.height).endStroke().endFill().setStrokeStyle(),this.getInputConnectors().forEach(n=>{let s=o.bounds.x-n.bounds.x,i=n.bounds.y-o.bounds.y;t.beginStroke("rgb(0,0,0)").setStrokeStyle(2).moveTo(e.x-s,e.y+i).lineTo(e.x,e.y+i).endStroke().setStrokeStyle()}),this.getOutputConnectors().forEach(n=>{let s=n.bounds.x-o.bounds.x,i=n.bounds.y-o.bounds.y;t.beginStroke("rgb(0,0,0)").setStrokeStyle(2).moveTo(e.x+o.bounds.width,e.y+i).lineTo(e.x+s,e.y+i).endStroke().setStrokeStyle()})}}class w{static andd(t,e){return t&&e}static orr(t,e){return t||e}static nott(t){return!t}static nandd(t,e){return this.nott(this.andd(t,e))}static norr(t,e){return this.nott(this.orr(t,e))}static xnorr(t,e){return!(t^e)}static xorr(t,e){return!this.xnorr(t,e)}}let f=null;class k extends v{constructor(t,e){super("AND-GATE","GATE",t),f=null===f?e:f,this.setupGate()}setupGate(){if(0===this.connectors.length){this.bounds.width=f.width,this.bounds.height=f.height;const n=11;var t=new C({x:this.bounds.x,y:this.bounds.y+n},"INPUT"),e=new C({x:this.bounds.x,y:this.bounds.y+this.bounds.height-n},"INPUT"),o=new C({x:this.bounds.x+this.bounds.width,y:this.bounds.y+this.bounds.height/2},"OUTPUT");this.connectors.push(t,e,o)}this.propagate()}propagate(){var t=this.connectors[0],e=this.connectors[1];this.connectors[2].updateState(w.andd(t.getState(),e.getState()))}paint(t,e){var o=new createjs.Matrix2D;o.translate(e.x,e.y),t.beginBitmapFill(f,"no-repeat",o).drawRect(e.x,e.y,f.width,f.height).endFill()}}let T=null;class E extends v{constructor(t,e){super("NAND-GATE","GATE",t),T=null===T?e:T,this.setupGate()}setupGate(){if(0===this.connectors.length){this.bounds.width=T.width,this.bounds.height=T.height;const n=11;var t=new C({x:this.bounds.x,y:this.bounds.y+n},"INPUT"),e=new C({x:this.bounds.x,y:this.bounds.y+this.bounds.height-n},"INPUT"),o=new C({x:this.bounds.x+this.bounds.width,y:this.bounds.y+this.bounds.height/2},"OUTPUT");this.connectors.push(t,e,o)}this.propagate()}propagate(){var t=this.connectors[0],e=this.connectors[1];this.connectors[2].updateState(w.nandd(t.getState(),e.getState()))}paint(t,e){var o=new createjs.Matrix2D;o.translate(e.x,e.y),t.beginBitmapFill(T,"no-repeat",o).drawRect(e.x,e.y,T.width,T.height).endFill()}}let M=null;class O extends v{constructor(t,e){super("OR-GATE","GATE",t),M=null===M?e:M,this.setupGate()}setupGate(){if(0===this.connectors.length){this.bounds.width=M.width,this.bounds.height=M.height;const n=11;var t=new C({x:this.bounds.x,y:this.bounds.y+n},"INPUT"),e=new C({x:this.bounds.x,y:this.bounds.y+this.bounds.height-n},"INPUT"),o=new C({x:this.bounds.x+this.bounds.width,y:this.bounds.y+this.bounds.height/2},"OUTPUT");this.connectors.push(t,e,o)}this.propagate()}propagate(){var t=this.connectors[0],e=this.connectors[1];this.connectors[2].updateState(w.orr(t.getState(),e.getState()))}paint(t,e){var o=new createjs.Matrix2D;o.translate(e.x,e.y),t.beginBitmapFill(M,"no-repeat",o).drawRect(e.x,e.y,M.width,M.height).endFill()}}let N=null;class R extends v{constructor(t,e){super("NOR-GATE","GATE",t),N=null===N?e:N,this.setupGate()}setupGate(){if(0===this.connectors.length){this.bounds.width=N.width,this.bounds.height=N.height;const n=11;var t=new C({x:this.bounds.x,y:this.bounds.y+n},"INPUT"),e=new C({x:this.bounds.x,y:this.bounds.y+this.bounds.height-n},"INPUT"),o=new C({x:this.bounds.x+this.bounds.width,y:this.bounds.y+this.bounds.height/2},"OUTPUT");this.connectors.push(t,e,o)}this.propagate()}propagate(){var t=this.connectors[0],e=this.connectors[1];this.connectors[2].updateState(w.norr(t.getState(),e.getState()))}paint(t,e){var o=new createjs.Matrix2D;o.translate(e.x,e.y),t.beginBitmapFill(N,"no-repeat",o).drawRect(e.x,e.y,N.width,N.height).endFill()}}let I=null;class D extends v{constructor(t,e){super("XOR-GATE","GATE",t),I=null===I?e:I,this.setupGate()}setupGate(){if(0===this.connectors.length){this.bounds.width=I.width,this.bounds.height=I.height;const n=11;var t=new C({x:this.bounds.x,y:this.bounds.y+n},"INPUT"),e=new C({x:this.bounds.x,y:this.bounds.y+this.bounds.height-n},"INPUT"),o=new C({x:this.bounds.x+this.bounds.width,y:this.bounds.y+this.bounds.height/2},"OUTPUT");this.connectors.push(t,e,o)}this.propagate()}propagate(){var t=this.connectors[0],e=this.connectors[1];this.connectors[2].updateState(w.xorr(t.getState(),e.getState()))}paint(t,e){var o=new createjs.Matrix2D;o.translate(e.x,e.y),t.beginBitmapFill(I,"no-repeat",o).drawRect(e.x,e.y,I.width,I.height).endFill()}}let P=null;class U extends v{constructor(t,e){super("XNOR-GATE","GATE",t),P=null===P?e:P,this.setupGate()}setupGate(){if(0===this.connectors.length){this.bounds.width=P.width,this.bounds.height=P.height;const n=11;var t=new C({x:this.bounds.x,y:this.bounds.y+n},"INPUT"),e=new C({x:this.bounds.x,y:this.bounds.y+this.bounds.height-n},"INPUT"),o=new C({x:this.bounds.x+this.bounds.width,y:this.bounds.y+this.bounds.height/2},"OUTPUT");this.connectors.push(t,e,o)}this.propagate()}propagate(){var t=this.connectors[0],e=this.connectors[1];this.connectors[2].updateState(w.xnorr(t.getState(),e.getState()))}paint(t,e){var o=new createjs.Matrix2D;o.translate(e.x,e.y),t.beginBitmapFill(P,"no-repeat",o).drawRect(e.x,e.y,P.width,P.height).endFill()}}let A=null;class F extends v{constructor(t,e){super("NOT-GATE","GATE",t),A=null===A?e:A,this.setupGate()}setupGate(){if(0===this.connectors.length){this.bounds.width=A.width,this.bounds.height=A.height;var t=new C({x:this.bounds.x,y:this.bounds.y+this.bounds.height/2},"INPUT"),e=new C({x:this.bounds.x+this.bounds.width,y:this.bounds.y+this.bounds.height/2},"OUTPUT");this.connectors.push(t,e)}this.propagate()}propagate(){var t=this.connectors[0];this.connectors[1].updateState(w.nott(t.getState()))}paint(t,e){var o=new createjs.Matrix2D;o.translate(e.x,e.y),t.beginBitmapFill(A,"no-repeat",o).drawRect(e.x,e.y,A.width,A.height).endFill()}}class G extends p{constructor(t,e,o){super(t,e,o)}setState(t){return this.connectors[0].updateState(t)}getState(){return this.connectors[0].getState()}loadSettings(t){super.loadSettings(t);let e=this;t.append('<button id="label-control" type="button">Set Label</button>'),$("#label-control").addClass("controls"),$("#label-control").on("click",()=>{let t=prompt("Enter new label:",e.label);e.label=null===t?e.label:t})}}const L=20,H=30;var j={};class B extends G{constructor(t){super("SWITCH-BUTTON","INPUT",t,!0),this.bounds.width=L,this.bounds.height=H;var e=new C({x:this.bounds.x+L+L/2,y:this.bounds.y+H/2},"OUTPUT");this.connectors.push(e),j[this.id]=0}rightClickUpEvent(){this.setState(!this.getState())}setSlideAmount(t){j[this.id]=t}paint(t,e){let o=this,n=j[this.id];const s=this.bounds.height/2;this.getOutputConnectors().forEach(n=>{let s=n.bounds.x-o.bounds.x,i=n.bounds.y-o.bounds.y;t.beginStroke("rgb(0,0,0)").setStrokeStyle(2).moveTo(e.x+o.bounds.width,e.y+i).lineTo(e.x+s,e.y+i).endStroke().setStrokeStyle()}),t.beginStroke("black").setStrokeStyle(2).drawRect(e.x,e.y,this.bounds.width,this.bounds.height).endStroke().setStrokeStyle(),t.beginFill("rgb(0,200,0)").drawRect(e.x+1,e.y+1,this.bounds.width-2,this.bounds.height/2).endFill(),t.beginFill("rgb(200,0,0)").drawRect(e.x+1,e.y+this.bounds.height/2,this.bounds.width-2,this.bounds.height/2-1).endFill();let i=e.y,r=this.bounds.height-s;t.beginFill("rgb(0,0,0,0.9)"),this.getState(),t.drawRect(e.x,i+r*n,this.bounds.width,s),t.endFill()}}const _=30;class V extends G{constructor(t){super("HOLD-BUTTON","INPUT",t,!0),this.bounds.width=_,this.bounds.height=_;var e=new C({x:this.bounds.x+_+_/2*(2/3),y:this.bounds.y+_/2},"OUTPUT");this.connectors.push(e)}rightClickDownEvent(){this.setState(!this.getState())}rightClickUpEvent(){this.setState(!this.getState())}paint(t,e){var o=e.x+_/2,n=e.y+_/2,s=this.getState()?"rgb(0,200,0)":"rgb(200,0,0)";t.beginStroke("rgb(0,0,0)").setStrokeStyle(2).moveTo(o,n).lineTo(o+_/2*1.5,n).endStroke().beginFill(s).drawCircle(o,n,_/2).endFill().beginStroke("rgb(0,0,0)").drawCircle(o,n,_/2).endStroke().setStrokeStyle()}}const Y=30,J=1e3;class X extends G{constructor(t){super("CLOCK","INPUT",t,!1),this.bounds.width=Y,this.bounds.height=Y,this.interval=J,this.nextTick=Date.now()+this.interval;var e=new C({x:this.bounds.x+Y+Y/2*(2/3),y:this.bounds.y+Y/2},"OUTPUT");this.connectors.push(e),this.start()}start(){var t=this;setInterval(()=>{t.nextTick<Date.now()&&(t.nextTick=Date.now()+t.interval,t.connectors[0].updateState(!t.connectors[0].getState()))},1)}paint(t,e){var o=e.x+Y/2,n=e.y+Y/2,s=this.getState()?"rgb(0,200,0)":"rgb(200,0,0)",i=this.getState()?"rgb(200,0,0)":"rgb(0,200,0)",r=2*Math.PI*((this.nextTick-Date.now())/this.interval);t.beginStroke("rgb(0,0,0)").setStrokeStyle(2).moveTo(o,n).lineTo(o+Y/2*1.5,n).endStroke().beginFill(s).drawCircle(o,n,Y/2).endFill().setStrokeStyle(Y/2).beginStroke(i).arc(o,n,Y/4,0,r,!1).endStroke().setStrokeStyle().setStrokeStyle(2).beginStroke("rgb(0,0,0)").drawCircle(o,n,Y/2).endStroke().beginFill("rgb(0,0,0)").drawCircle(o,n,Y/3).endFill().setStrokeStyle()}loadSettings(t){super.loadSettings(t);let e=this;t.append('<input id="clock-timer-control" type="button" value="Set Interval">'),$("#clock-timer-control").addClass("controls"),$("#clock-timer-control").on("click",()=>{let t=prompt("Set new interval (ms): ",e.interval),o=parseInt(t);null!==t&&(!isNaN(o)&&isFinite(o)?(e.interval=parseInt(o,10),e.nextTick=Date.now()+e.interval):alert(t+" is not a number!"))})}}class W extends p{constructor(t,e,o){super(t,e,o)}setState(t){return this.connectors[0].updateState(t)}getState(){return this.connectors[0].getState()}stateChangedEvent(){}loadSettings(t){super.loadSettings(t);let e=this;t.append('<button id="label-control" type="button">Set Label</button>'),$("#label-control").addClass("controls"),$("#label-control").on("click",()=>{let t=prompt("Enter new label:",e.label);e.label=null===t?e.label:t})}}const Q=25,z="#00FF00";class K extends W{constructor(t){super("LED","OUTPUT",t),this.bounds.width=Q,this.bounds.height=Q,this.color=this.color?this.color:z;var e=new C({x:this.bounds.x-Q/2*(2/3),y:this.bounds.y+Q/2},"INPUT");this.connectors.push(e)}lightenDarkenColor(t,e){var o;(o="#"===t[0])&&(t=t.slice(1));let n=function(t){return Math.ceil(t>255?255:t<0?0:t)};var s=parseInt(t,16),i=(s>>16&255)*e,r=(s>>8&255)*e,l=(s>>0&255)*e;return i=n(i),r=n(r),l=n(l),(o?"#":"")+String("000000"+(i<<16|r<<8|l).toString(16)).slice(-6)}paint(t,e){var o=e.x+Q/2,n=e.y+Q/2,s=this.lightenDarkenColor(this.color,.5),i=this.lightenDarkenColor(this.color,.25),r=this.getState()?s:i,l=this.getState()?this.color:s;t.beginStroke("rgb(0,0,0)").setStrokeStyle(2).moveTo(o,n).lineTo(o-Q/2*1.5,n).endStroke().beginFill(r).drawCircle(o,n,Q/2).endFill().beginRadialGradientFill(["rgba(0,0,0,0)",l],[1,0],o,n,0,o,n,Q).drawCircle(o,n,Q/2).endFill().beginStroke("rgb(0,0,0)").setStrokeStyle(1).drawCircle(o,n,Q/2).endStroke().setStrokeStyle()}loadSettings(t){super.loadSettings(t);let e=this,o='<input id="led-color-control" type="button" value="Set Color" style="color:'+this.color+';">';t.append('<input id="led-color-picker" type="color" style="display:none;">'),t.append(o),$("#led-color-control").addClass("controls"),$("#led-color-control").on("click",()=>{$("#led-color-picker").get(0).dispatchEvent(new MouseEvent("click",{bubbles:!0,cancelable:!0,view:window}))}),$("#led-color-picker").on("change",t=>{e.color=t.target.value,$("#led-color-control").css("color",e.color)})}}const q=60,Z=100;var tt=null;class et extends W{constructor(t){super("SEVEN-SEG-DISP","OUTPUT",t),this.bounds.width=q,this.bounds.height=Z;for(var e=this.bounds.height/7/2,o=this.bounds.x-this.bounds.width/5,n=0;n<7;n++){var s=this.bounds.y+e+this.bounds.height/7*n,i=new C(new createjs.Rectangle(o,s,0,0),"INPUT");this.connectors.push(i)}}getStateIndex(t){return this.connectors[t].getState()}setHoveredConnector(t){tt=t}paint(t,e){const o=this.bounds.width*(2/3),n=this.bounds.height/10,s=this.bounds.width/12;let i=null!==tt&&this.connectors.includes(tt);for(var r=this.bounds.height/7/2,l=e.x-this.bounds.width/5,c=0;c<7;c++){var a=e.y+r+this.bounds.height/7*c;t.beginStroke("black").setStrokeStyle(2).moveTo(l,a).lineTo(e.x,a).setStrokeStyle().endStroke()}t.beginStroke("rgba(0,0,0,0.9)").setStrokeStyle(2).beginFill("rgba(0,0,0,0.8)").moveTo(e.x,e.y).drawRect(e.x,e.y,this.bounds.width,this.bounds.height).setStrokeStyle().endStroke().endFill();var h=(this.bounds.height-n)/2-n/2;for(l=e.x+(this.bounds.width/3-n),c=0;c<3;c++){a=e.y+h*c+n;var d=this.getStateIndex(3*c)?"rgba(0,255,0,0.7)":"rgba(255,255,255,0.25)";i&&tt===this.connectors[3*c]&&(d="rgba(255,50,255,0.7)"),t.beginFill(d).moveTo(l,a).lineTo(l+s,a+n/2).lineTo(l+(o-s),a+n/2).lineTo(l+o,a).lineTo(l+(o-s),a-n/2).lineTo(l+s,a-n/2).lineTo(l,a).endFill()}var u=e.x+(this.bounds.width/3-n),g=e.y+n;for(c=0;c<4;c++){l=c%2!=0?u:u+o,a=c<2?g:g+o;var p=0==c?1:1==c?2:2==c?4:3==c?5:-1;d=this.getStateIndex(p)?"rgba(0,255,0,0.7)":"rgba(255,255,255,0.25)",i&&tt===this.connectors[p]&&(d="rgba(255,50,255,0.7)"),t.beginFill(d).moveTo(l,a).lineTo(l+n/2,a+s).lineTo(l+n/2,a+(o-s)).lineTo(l,a+o).lineTo(l-n/2,a+(o-s)).lineTo(l-n/2,a+s).lineTo(l,a).endFill()}}}const ot=25;class nt extends W{constructor(t){super("CONSOLE","OUTPUT",t),this.bounds.width=ot,this.bounds.height=ot;var e=new C({x:this.bounds.x-this.bounds.width/2,y:this.bounds.y+this.bounds.height/2},"INPUT");this.connectors.push(e)}paint(t,e){var o=e.y+this.bounds.height/2;t.beginStroke("rgb(0,0,0)").setStrokeStyle(2).moveTo(e.x,o).lineTo(e.x-this.bounds.width/2,o).endStroke().beginFill("rgba(0,0,0,0.8)").beginStroke("rgb(0,0,0)").setStrokeStyle(2).drawRect(e.x,e.y,this.bounds.width,this.bounds.height).endStroke().endFill().setStrokeStyle();const n=this.getState()?"1":"0",s=this.getState()?"rgb(0,255,0)":"rgb(255,0,0)";var i=new createjs.Text(n,"bold 20px Courier",s);i.cache(0,0,this.bounds.width,this.bounds.height);var r=new Image(this.bounds.width,this.bounds.height);r.src=i.bitmapCache.getCacheDataURL();var l=new createjs.Matrix2D;l.translate(e.x+this.bounds.width/2-i.getMeasuredWidth()/2,e.y+this.bounds.height/2-i.getMeasuredLineHeight()/2),t.beginBitmapFill(r,"repeat",l).drawRect(e.x,e.y,this.bounds.width,this.bounds.height).endFill()}stateChangedEvent(){console.log(this.label+":"+this.getState())}}const st=1;var it,rt,lt,ct,at,ht,dt;(()=>{$(document).ready(()=>{console.info("loading stage..."),it=new createjs.StageGL("logic-canvas"),dt=new class{constructor(){this.resourceQueue=new createjs.LoadQueue(!0,"img/lpg/")}loadResources(t){console.info("loading resources..."),this.resourceQueue.loadManifest([{src:"and-gate.png",id:"and-gate"},{src:"nand-gate.png",id:"nand-gate"},{src:"or-gate.png",id:"or-gate"},{src:"nor-gate.png",id:"nor-gate"},{src:"xor-gate.png",id:"xor-gate"},{src:"xnor-gate.png",id:"xnor-gate"},{src:"not-gate.png",id:"not-gate"}],!0),this.resourceQueue.on("complete",t)}getResource(t){return this.resourceQueue.getResult(t)}},rt=new class{constructor(t){this.activeModule=void 0,this.activeModules=[],this.resourceController=t}startLogicTimer(){var t=this;setInterval(()=>{void 0!==t.activeModule&&t.activeModule.propagate(!0)},st)}newModule(){this.setActiveModule(new y(new createjs.Rectangle(0,0)))}setActiveModule(t){this.activeModule=t,this.activeModule.updateConnectorMap()}loadModule(t){let e=new y(new createjs.Rectangle(0,0)),o=this,n=t=>{let e=new C(t.bounds,t.type);for(var o in t)e[o]=t[o];return e.bounds=new createjs.Rectangle(t.bounds.x,t.bounds.y,t.bounds.width,t.bounds.height),e};for(var s in t)e[s]=t[s];return e.bounds=new createjs.Rectangle(t.bounds.x,t.bounds.y,t.bounds.width,t.bounds.height),e.connectors=[],t.connectors.forEach(t=>e.connectors.push(n(t))),e.components=[],t.components.forEach(t=>e.components.push((t=>{let e=null;if("MODULE"===t.type)e=o.loadModule(t);else for(var s in e=o.createComponent(t.type,t.bounds),t)e[s]=t[s];return e.bounds=new createjs.Rectangle(t.bounds.x,t.bounds.y,t.bounds.width,t.bounds.height),e.connectors=[],t.connectors.forEach(t=>e.connectors.push(n(t))),e})(t))),e.updateBounds(),e}createComponent(t,e){switch(t.toUpperCase()){case"CONNECTOR":return new C(e);case"MODULE":return new y(e);case"AND-GATE":return new k(e,this.resourceController.getResource("and-gate"));case"NAND-GATE":return new E(e,this.resourceController.getResource("nand-gate"));case"OR-GATE":return new O(e,this.resourceController.getResource("or-gate"));case"NOR-GATE":return new R(e,this.resourceController.getResource("nor-gate"));case"XOR-GATE":return new D(e,this.resourceController.getResource("xor-gate"));case"XNOR-GATE":return new U(e,this.resourceController.getResource("xnor-gate"));case"NOT-GATE":return new F(e,this.resourceController.getResource("not-gate"));case"HOLD-BUTTON":return new V(e);case"SWITCH-BUTTON":return new B(e);case"CLOCK":return new X(e);case"LED":return new K(e);case"SEVEN-SEG-DISP":return new et(e);case"CONSOLE":return new nt(e);default:return alert('Invalid component type: "'+t+'"'),null}}importModule(t,e){return this.refreshConnectors(t),this.activeModule.addComponent(t),t.bounds=e,t.updateBounds(),t.propagate(),this.activeModule.updateConnectorMap(),t}refreshConnectors(t){t.connectors.forEach(t=>{t.id=uuid()}),this.activeModule.updateConnectorMap()}addComponent(t,e){var o=this.createComponent(t,e);return null!==o?this.activeModule.addComponent(o):(this.activeModule.updateConnectorMap(),null)}breakConnections(t){var e=this;t.isInput()?t.connections.forEach(o=>{var n=e.activeModule.getConnector(o);t.removeConnection(n)}):e.activeModule.components.forEach(o=>{o.connectors.forEach(o=>{o.isInput()&&o.connections.forEach(n=>{n===t.getID()&&o.removeConnection(e.activeModule.getConnector(t.getID()))})})}),this.activeModule.updateConnectorMap()}deleteComponent(t,e){var o=this;e.connectors.forEach(t=>{o.breakConnections(t)}),t.removeComponent(e),t.updateConnectorMap()}}(dt),lt=new class{constructor(t){this.moduleController=t}saveActiveModule(){this.moduleController.activeModule.label=$("#module-name").val(),console.log(JSON.stringify(this.moduleController.activeModule)),localStorage.setItem("autosaveModule",JSON.stringify(this.moduleController.activeModule))}loadSavedModule(){if(localStorage.autosaveModule){console.info("loading saved module...");let t=JSON.parse(localStorage.autosaveModule);this.moduleController.setActiveModule(this.moduleController.loadModule(t)),console.info("saved module loaded!")}else this.moduleController.newModule();$("#module-name").val(this.moduleController.activeModule.label)}exportActiveModule(){const t=JSON.stringify(this.moduleController.activeModule),e=this.moduleController.activeModule.label+".lpm";var o=new Blob([t],{type:"application/octet-stream"});$("#export-module-dialog").attr("href",URL.createObjectURL(o)),$("#export-module-dialog").attr("download",e),$("#export-module-dialog").get(0).dispatchEvent(new MouseEvent("click",{bubbles:!0,cancelable:!0,view:window}))}loadModuleFile(t){var e=this;console.log("loading file"),$("#load-module-dialog").get(0).dispatchEvent(new MouseEvent("click",{bubbles:!0,cancelable:!0,view:window})),$("#load-module-dialog").click(()=>{$("#load-module-dialog").get(0).value=null}),$("#load-module-dialog").on("change",()=>{var o=document.getElementById("load-module-dialog").files;if(o.length||1!==o.length){var n=o[0];if(n.name.includes(".lpm")){var s=new FileReader;s.onloadend=(o=>{o.target.readyState==FileReader.DONE&&t(e,o.target.result)});var i=n.slice(0,n.size);return s.readAsText(i),!1}alert("Please select a valid .lpm file!")}else alert("Please select an LPM file!")})}loadModule(t,e){console.info("loading module..."),t.moduleController.setActiveModule(t.moduleController.loadModule(JSON.parse(e))),$("#module-name").val(t.moduleController.activeModule.label)}importModule(t,e){console.info("importing module..."),sessionStorage.importedModules||sessionStorage.setItem("importedModules",JSON.stringify([]));var o=JSON.parse(sessionStorage.importedModules);o.push(e),sessionStorage.setItem("importedModules",JSON.stringify(o))}}(rt),ct=new class{constructor(t,e){this.stage=t,this.moduleController=e,this.activeState=null,this.activeClick=null,this.selectionRect=new createjs.Rectangle,this.selectedComponents=[],this.selectedConnector=null,this.hoveredConn=null,this.hoveredComp=null,this.clickPos=null,this.mousePos=null}setActiveState(t,e){switch(t){case s.EMPTY:this.activeState=new i(this);break;case s.PANNING:this.activeState=new c(this);break;case s.SELECTING:this.activeState=new a(this);break;case s.HOVER_COMPONENT:this.activeState=new l(this,e);break;case s.HOVER_CONNECTOR:this.activeState=new r(this,e);break;case s.DRAGGING:this.activeState=new h(this);break;case s.CONNECTING:this.activeState=new d(this,e)}this.activeState.name=t}getActiveState(){return this.activeState.name}initMouseEvents(){let t=this;t.stage.on("stagemousedown",e=>{t.activeClick=e.nativeEvent.button,t.clickPos=new createjs.Point(e.stageX,e.stageY),t.isLeftClicking()?t.activeState.handleLeftClickDown(e):t.isRightClicking()&&t.activeState.handleRightClickDown(e)}),t.stage.on("stagemouseup",e=>{t.isLeftClicking()?t.activeState.handleLeftClickUp(e):t.isRightClicking()&&t.activeState.handleRightClickUp(e),t.activeClick=null,t.clickPos=null}),t.stage.on("stagemousemove",e=>{t.mousePos=new createjs.Point(e.stageX,e.stageY),t.activeState.handleMouseMove(e),t.isLeftClicking()?t.activeState.handleMouseDragLeft(e):t.isRightClicking()&&t.activeState.handleMouseDragRight(e)}),t.stage.on("dblclick",e=>{t.activeState.handleDoubleClick(e)})}getHoveredComponent(){let t=this,e=null;return null!==t.mousePos&&null===t.hoveredConn&&t.moduleController.activeModule.components.forEach(o=>{let n=t.getRealCoords(t.mousePos);if(o.bounds.contains(n.x,n.y))return e=o,!1}),e}getHoveredConnector(){let t=this,e=null;return null!==t.mousePos&&t.moduleController.activeModule.components.forEach(o=>{if(null!==e)return!1;let n=t.getRealCoords(t.mousePos);o.getConnectors().forEach(t=>{let o=t.getRealBounds().width,s=t.getRealBounds().height;if(new createjs.Rectangle(t.getRealBounds().x-o/2,t.getRealBounds().y-s/2,2*t.getRealBounds().width,2*t.getRealBounds().height).contains(n.x,n.y))return e=t,!1})}),e}getSelectedComponents(){let t=this,e=[];return null!==t.selectionRect&&t.moduleController.activeModule.components.forEach(o=>{let n=t.getRealCoords({x:t.selectionRect.x,y:t.selectionRect.y}),s=new createjs.Rectangle(n.x,n.y,t.selectionRect.width,t.selectionRect.height);o.bounds.intersects(s)&&e.push(o)}),e}getSelectedConnector(){return this.selectedConnector}wrapSelection(){let t=this,e=this.selectionRect.x+this.selectionRect.width,o=this.selectionRect.y+this.selectionRect.height,n=this.selectionRect.x,s=this.selectionRect.y;t.selectedComponents.forEach(i=>{let r=t.getScreenCoords(i.bounds);e=r.x<=e?r.x:e,o=r.y<=o?r.y:o,n=r.x+i.bounds.width>=n?r.x+i.bounds.width:n,s=r.y+i.bounds.height>=s?r.y+i.bounds.height:s}),t.selectionRect=new createjs.Rectangle(e,o,n-e,s-o)}clearSelection(){this.selectionRect=new createjs.Rectangle,this.selectedComponents=[],this.toggleComponentSettings(!1)}toggleComponentSettings(t){$("#component-controls").css("visibility",t?"visible":"hidden"),$("#module-controls").css("visibility",t?"hidden":"visible")}showComponentSelection(){let t=""===this.selectedComponents[0].label?"no label":this.selectedComponents[0].label;this.toggleComponentSettings(!0),$("#component-name").val(t),this.selectedComponents[0].loadSettings($("#component-control-loader"))}isLeftClicking(){return this.activeClick===u}isRightClicking(){return this.activeClick===g}getMouseLoc(){return this.mousePos}getSelectionRect(){return this.selectionRect}getRealCoords(t){let e=this.moduleController.activeModule.startPos;return{x:t.x-e.x,y:t.y-e.y}}getScreenCoords(t){let e=this.moduleController.activeModule.startPos;return{x:t.x+e.x,y:t.y+e.y}}}(it,rt),at=new class{constructor(t,e,o){this.moduleController=t,this.selectionController=e,this.fileController=o,this.visibleImports=[]}setupDragNDropHandler(){var t=this;$("#logic-canvas").on("dragover",t=>t.preventDefault()).on("drop",e=>{e.preventDefault();var o,n=e.originalEvent.dataTransfer.getData("text/x-component"),s=e.clientX-$("#logic-canvas").offset().left,i=e.clientY-$("#logic-canvas").offset().top,r=t.selectionController.getRealCoords({x:s,y:i}),l=new createjs.Rectangle(r.x,r.y,0,0);if(n.includes("imported_")){var c=n.replace("imported_","");o=t.moduleController.importModule(t.getImportedModule(c),l)}else o=t.moduleController.addComponent(n,l);null!==o&&o.moveTo(o.bounds.x-o.bounds.width/2,o.bounds.y-o.bounds.height/2)})}addDragListeners(){$(".drag-item").on("dragstart",t=>{t.originalEvent.dataTransfer.setData("text/x-component",t.target.id)})}setupModuleControlHandlers(){var t=this;$("#controls-new").click(()=>{confirm("Are you sure? You will lose anything not saved!")&&(t.moduleController.newModule(),$("#module-name").val(t.moduleController.activeModule.label))}),$("#controls-save").click(()=>t.fileController.saveActiveModule()),$("#controls-export").click(()=>t.fileController.exportActiveModule()),$("#controls-load").click(()=>t.fileController.loadModuleFile(t.fileController.loadModule)),$("#controls-import").click(()=>t.fileController.loadModuleFile(t.fileController.importModule)),$("#module-name").on("input propertychange paste",()=>{t.moduleController.activeModule.label=$("#module-name").val()}),$("#module-back-button").click(e=>{if(e.preventDefault(),t.moduleController.activeModules.length>0){var o=t.moduleController.activeModules.pop();t.moduleController.setActiveModule(o),0===t.moduleController.activeModules.length&&$("#module-back-button").css("visibility","hidden"),$("#module-name").val(t.moduleController.activeModule.label),t.selectionController.clearSelection()}})}setupPoolControlHandlers(){$("#pool-gates").click(()=>{$("#component-menu").css("visibility","hidden"),$("#gate-pool").css("visibility","visible")}),$("#pool-inputs").click(()=>{$("#component-menu").css("visibility","hidden"),$("#input-pool").css("visibility","visible")}),$("#pool-outputs").click(()=>{$("#component-menu").css("visibility","hidden"),$("#output-pool").css("visibility","visible")}),$("#pool-imports").click(()=>{$("#component-menu").css("visibility","hidden"),$("#import-pool").css("visibility","visible")}),$("#gate-pool-back").click(()=>{$("#gate-pool").css("visibility","hidden"),$("#component-menu").css("visibility","visible")}),$("#input-pool-back").click(()=>{$("#input-pool").css("visibility","hidden"),$("#component-menu").css("visibility","visible")}),$("#output-pool-back").click(()=>{$("#output-pool").css("visibility","hidden"),$("#component-menu").css("visibility","visible")}),$("#import-pool-back").click(()=>{$("#import-pool").css("visibility","hidden"),$("#component-menu").css("visibility","visible")})}loadDefaultComponents(){var t=this,e=[];e.push(this.moduleController.createComponent("and-gate",{x:0,y:0})),e.push(this.moduleController.createComponent("nand-gate",{x:0,y:0})),e.push(this.moduleController.createComponent("or-gate",{x:0,y:0})),e.push(this.moduleController.createComponent("nor-gate",{x:0,y:0})),e.push(this.moduleController.createComponent("xor-gate",{x:0,y:0})),e.push(this.moduleController.createComponent("xnor-gate",{x:0,y:0})),e.push(this.moduleController.createComponent("not-gate",{x:0,y:0}));var o=[];o.push(this.moduleController.createComponent("switch-button",{x:0,y:0})),o.push(this.moduleController.createComponent("hold-button",{x:0,y:0})),o.push(this.moduleController.createComponent("clock",{x:0,y:0}));var n=[];n.push(this.moduleController.createComponent("led",{x:0,y:0})),n.push(this.moduleController.createComponent("seven-seg-disp",{x:0,y:0})),n.push(this.moduleController.createComponent("console",{x:0,y:0}));var s=t=>'<div class="pool item shadowed">        <img class="drag-item" id="'+t.type+'" src="'+t.exportImage()+'" draggable="true" width="70">        <h4 class="controls">'+t.type.replace("-GATE","").replace("-BUTTON","")+"</h4>      </div>";e.forEach(e=>{var o=s(e);$("#gate-items").append(o),t.addDragListeners()}),o.forEach(e=>{let o=s(e);$("#input-items").append(o),t.addDragListeners()}),n.forEach(e=>{let o=s(e);$("#output-items").append(o),t.addDragListeners()})}loadImportedModule(t){var e=(t=>'<div class="pool item shadowed">        <img class="drag-item" id="imported_'+t.label+'" src="'+t.exportImage()+'" draggable="true">        <h4 class="controls">'+t.label+"</h4>      </div>")(t);$("#import-items").append(e),this.addDragListeners()}setupKeyListeners(){var t=this;$(document).keydown(e=>{switch(e.keyCode){case 46:t.selectionController.selectedComponents.forEach(e=>{t.moduleController.deleteComponent(t.moduleController.activeModule,e)}),t.selectionController.clearSelection()}})}getImportedModule(t){var e=this,o=null;return JSON.parse(sessionStorage.importedModules).forEach(n=>{if(null!==o)return!1;var s=JSON.parse(n);return s.label===t?(o=e.moduleController.loadModule(s),!1):void 0}),o}checkImports(){var t=this;setInterval(()=>{void 0!==sessionStorage.importedModules&&JSON.parse(sessionStorage.importedModules).forEach(e=>{if(!t.visibleImports.includes(e)){var o=t.moduleController.loadModule(JSON.parse(e));t.loadImportedModule(o),t.visibleImports.push(e)}})},250)}}(rt,ct,lt),ht=new class{constructor(t,e,o,n){this.stage=t,this.stage.setClearColor("#FFF"),this.flowOffset=0,this.moduleController=o,this.selectionController=e,this.resourceController=n,this.buffer=new createjs.Shape,this.graphics=this.buffer.graphics,this.stage.addChild(this.buffer),this.background=void 0,this.grid=void 0,this.fitStage=this.fitStage.bind(this),window.addEventListener("resize",this.fitStage,!1),this.fitStage(),setInterval(()=>{console.log("FPS: "+createjs.Ticker.getMeasuredFPS())},1e3)}fitStage(){this.stage.canvas.width=.75*window.innerWidth,this.stage.canvas.height=.75*window.innerHeight,this.stage.updateViewport(.75*window.innerWidth,.75*window.innerHeight),this.buffer.uncache(),this.buffer.cache(0,0,this.stage.canvas.width,this.stage.canvas.height),this.background=void 0,this.grid=void 0}startPainting(){createjs.Ticker.on("tick",this.paint.bind(this)),createjs.Ticker.timingMode=createjs.Ticker.RAF}startAnimationTimer(){let t=this,e={};setInterval(()=>{t.flowOffset=t.flowOffset<20?t.flowOffset+1:1,t.moduleController.activeModule.components.forEach(t=>{if("SWITCH-BUTTON"===t.type){e[t.id]||(e[t.id]=0);let o=e[t.id];t.getState()?e[t.id]=o<1?o+.1:1:e[t.id]=o>0?o-.1:0,t.setSlideAmount(e[t.id])}})},10)}paint(){setTimeout(()=>{this.graphics.clear(),void 0===this.background&&this.drawBackground(),void 0===this.grid&&this.drawGrid(),this.drawOrigin(),this.drawSelection(),this.buffer.updateCache(),this.stage.update()},0)}drawBackground(){console.log("drawing background..."),this.background=new createjs.Shape,this.background.graphics.beginLinearGradientFill(["#FFF","#DDD"],[.5,1],0,0,0,this.stage.canvas.height).rect(0,0,this.stage.canvas.width,this.stage.canvas.height).endFill(),this.background.cache(0,0,this.stage.canvas.width,this.stage.canvas.height),this.stage.addChildAt(this.background,0)}drawGrid(){this.grid=new createjs.Shape;let t=this.moduleController.activeModule.startPos;this.grid.graphics.setStrokeDash([25],1);for(let e=t.x%50;e<this.stage.canvas.width;e+=50)this.grid.graphics.beginStroke("#CCC").moveTo(e,t.y%50-12.5).lineTo(e,this.stage.canvas.height).endStroke();for(let e=t.y%50;e<this.stage.canvas.height;e+=50)this.grid.graphics.beginStroke("#CCC").moveTo(t.x%50-12.5,e).lineTo(this.stage.canvas.width,e).endStroke();this.grid.graphics.setStrokeDash(),this.grid.cache(0,0,this.stage.canvas.width,this.stage.canvas.height),this.stage.addChildAt(this.grid,1)}drawOrigin(){let t=this.moduleController.activeModule.startPos.x,e=this.moduleController.activeModule.startPos.y;this.graphics.beginFill("red").drawCircle(t,e,2).endFill()}drawComponents(){let t=this;this.moduleController.activeModule.components.forEach(e=>{let o=t.selectionController.getScreenCoords(e.bounds);e.paint(t.graphics,o),e.connectors.forEach(e=>{let o=t.selectionController.getScreenCoords(e.bounds);e.paint(t.graphics,o)})})}drawHoveredComponent(){if("HOVER-COMPONENT"===this.selectionController.getActiveState()){let t=this.selectionController.getHoveredComponent();if(null!==t){let e=this.selectionController.getScreenCoords({x:t.bounds.x,y:t.bounds.y});const o=2;this.graphics.beginFill("rgba(127,0,0,0.3)").drawRect(e.x-o/2,e.y-o/2,t.bounds.width+o,t.bounds.height+o).endFill().beginStroke("rgba(127,0,0,0.2)").setStrokeStyle(2).drawRect(e.x-o/2,e.y-o/2,t.bounds.width+o,t.bounds.height+o).endStroke()}}}drawComponentSelections(){let t=this;this.selectionController.selectedComponents.forEach(e=>{let o=t.selectionController.getScreenCoords({x:e.bounds.x,y:e.bounds.y});t.graphics.beginFill("rgba(150,0,0,0.3)").drawRect(o.x-1,o.y-1,e.bounds.width+2,e.bounds.height+2).endFill().beginStroke("rgba(150,0,0,0.4)").setStrokeStyle(2).drawRect(o.x-1,o.y-1,e.bounds.width+2,e.bounds.height+2).endStroke()})}drawHoveredConnector(){if("HOVER-CONNECTOR"===this.selectionController.getActiveState()||"CONNECTING"===this.selectionController.getActiveState()){let t=this.selectionController.getHoveredConnector();if(null!==t){let e=this.selectionController.getScreenCoords({x:t.bounds.x,y:t.bounds.y});this.graphics.beginFill("rgba(150,0,0,0.5)").drawCircle(e.x,e.y,t.bounds.width).endFill().beginStroke("rgba(150,0,0,1)").setStrokeStyle(2).drawCircle(e.x,e.y,t.bounds.width).endStroke()}}}drawConnectorSelection(){let t=this.selectionController.getSelectedConnector();if(null!==t){let e=this.selectionController.getScreenCoords({x:t.bounds.x,y:t.bounds.y});this.graphics.beginFill("rgba(150,0,0,0.5)").drawCircle(e.x,e.y,t.bounds.width).endFill().beginStroke("rgba(150,0,0,1)").setStrokeStyle(2).drawCircle(e.x,e.y,t.bounds.width).endStroke()}}drawSelection(){if(this.selectionController.getActiveState()===s.SELECTING){let t=this.selectionController.getSelectionRect();this.graphics.beginFill("rgba(0,50,127,0.3)").drawRect(t.x,t.y,t.width,t.height).endFill().beginStroke("rgba(0,50,127,0.4)").setStrokeStyle(2).drawRect(t.x,t.y,t.width,t.height).endStroke()}}drawCurrentWire(){let t=this.selectionController.getSelectedConnector();if(null!==t){let e=this.selectionController.getScreenCoords(t.bounds),o=this.selectionController.getMouseLoc();this.graphics.beginStroke("rgb(0,0,0)").setStrokeStyle(4).moveTo(e.x,e.y).lineTo(o.x,o.y).endStroke().setStrokeStyle()}}drawAllWires(){let t=this;Object.keys(t.moduleController.activeModule.getConnectorMap()).forEach(e=>{let o=t.moduleController.activeModule.getConnector(e),n=t.selectionController.getScreenCoords(o.bounds);t.moduleController.activeModule.getConnectorMap()[e].forEach(e=>{let o=t.selectionController.getScreenCoords(e.bounds),s=e.getState()?"rgb(0,100,0)":"rgb(50,0,0)";t.graphics.beginStroke(s).setStrokeStyle(6).moveTo(o.x,o.y).bezierCurveTo(o.x+30,o.y,n.x-30,n.y,n.x,n.y).endStroke().setStrokeStyle(),e.getState()&&t.graphics.beginStroke("rgb(0,200,0)").setStrokeStyle(3).setStrokeDash([10],-t.flowOffset).moveTo(o.x,o.y).bezierCurveTo(o.x+30,o.y,n.x-30,n.y,n.x,n.y).endStroke().setStrokeStyle().setStrokeDash()})})}}(it,ct,rt,dt),$("#logic-canvas").bind("contextmenu",()=>!1),ht.fitStage(),dt.loadResources(()=>{lt.loadSavedModule(),ht.startPainting(),ht.startAnimationTimer(),at.loadDefaultComponents(),at.setupDragNDropHandler(),at.setupPoolControlHandlers(),at.setupModuleControlHandlers(),at.setupKeyListeners(),at.checkImports(),rt.activeModule.updateConnectorMap(),rt.startLogicTimer(),it.mouseMoveOutside=!0,ct.initMouseEvents(),ct.setActiveState("EMPTY")})})})()}]);